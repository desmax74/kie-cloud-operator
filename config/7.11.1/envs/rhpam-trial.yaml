console:
  deploymentConfigs:
    - metadata:
        name: "[[.ApplicationName]]-[[.Console.Name]]"
      spec:
        template:
          spec:
            containers:
              - name: "[[.ApplicationName]]-[[.Console.Name]]"
                env:
                  - name: KIE_SERVER_HOST
                resources:
                  limits:
                    memory: 2Gi
            volumes:
              - name: "[[.ApplicationName]]-[[.Console.Name]]-pvol"
                emptyDir: {}
  persistentVolumeClaims:
    - metadata:
        name: "[[.ApplicationName]]-[[.Console.Name]]-claim"
        annotations:
          delete: "true"

  routes:
    - id: "[[.ApplicationName]]-[[.Console.Name]]-http"
      metadata:
        name: "[[.ApplicationName]]-[[.Console.Name]]-http"
        labels:
          app: "[[.ApplicationName]]"
          application: "[[.ApplicationName]]"
          service: "[[.ApplicationName]]-[[.Console.Name]]"
        annotations:
          description: Route for Business Central's http service.
          haproxy.router.openshift.io/timeout: 60s
      spec:
        to:
          name: "[[.ApplicationName]]-[[.Console.Name]]"
        port:
          targetPort: http
## KIE Servers BEGIN
servers:
  ## RANGE BEGINS
  #[[ range $index, $Map := .Servers ]]
  - deploymentConfigs:
      ## KIE server deployment config BEGIN
      - metadata:
          name: "[[.KieName]]"
        spec:
          template:
            metadata:
              name: "[[.KieName]]"
            spec:
              containers:
                - name: "[[.KieName]]"
                  env:
                    #[[if .Cors]]
                    - name: FILTERS
                      value: "[[.Cors.Filters]]"
                    - name: AC_ALLOW_ORIGIN_FILTER_RESPONSE_HEADER_NAME
                      value: "[[.Cors.AllowOriginName]]"
                    - name: AC_ALLOW_ORIGIN_FILTER_RESPONSE_HEADER_VALUE
                      value: "[[.Cors.AllowOriginValue]]"
                    - name: AC_ALLOW_METHODS_FILTER_RESPONSE_HEADER_NAME
                      value: "[[.Cors.AllowMethodsName]]"
                    - name: AC_ALLOW_METHODS_FILTER_RESPONSE_HEADER_VALUE
                      value: "[[.Cors.AllowMethodsValue]]"
                    - name: AC_ALLOW_HEADERS_FILTER_RESPONSE_HEADER_NAME
                      value: "[[.Cors.AllowHeadersName]]"
                    - name: AC_ALLOW_HEADERS_FILTER_RESPONSE_HEADER_VALUE
                      value: "[[.Cors.AllowHeadersValue]]"
                    - name: AC_ALLOW_CREDENTIALS_FILTER_RESPONSE_HEADER_NAME
                      value: "[[.Cors.AllowCredentialsName]]"
                    - name: AC_ALLOW_CREDENTIALS_FILTER_RESPONSE_HEADER_VALUE
                      value: "[[.Cors.AllowCredentialsValue]]"
                    - name: AC_MAX_AGE_FILTER_RESPONSE_HEADER_NAME
                      value: "[[.Cors.MaxAgeName]]"
                    - name: AC_MAX_AGE_FILTER_RESPONSE_HEADER_VALUE
                      value: "[[.Cors.MaxAgeValue]]"
                    #[[end]]
                  resources:
                    limits:
                      memory: 1Gi
    ## KIE server deployment config END
    ## KIE server route BEGIN
    routes:
      - id: "[[.KieName]]-http"
        metadata:
          name: "[[.KieName]]-http"
          labels:
            app: "[[$.ApplicationName]]"
            application: "[[$.ApplicationName]]"
            service: "[[.KieName]]"
          annotations:
            description: Route for KIE server's http service.
            haproxy.router.openshift.io/balance: source
            haproxy.router.openshift.io/timeout: 60s
        spec:
          to:
            name: "[[.KieName]]"
          port:
            targetPort: http
    ## KIE server route END
#[[end]]
## RANGE ends
## KIE Servers END
